<?xml version="1.0" encoding="utf-8"?>
<odoo>
<template id="sale_order_portal_content_inherit_unit_price_check"
          inherit_id="sale.sale_order_portal_content">

    <!-- ==================== HEADER ==================== -->
    <xpath expr="//table[@id='sales_order_table']/thead/tr" position="replace">

        <!-- ensure lines_to_report exists early -->
        <t t-set="lines_to_report" t-value="sale_order._get_order_lines_to_report()"/>

        <!-- priceable lines -->
        <t t-set="visible_price_lines"
           t-value="lines_to_report.filtered(lambda l: not l.display_type and not l.is_downpayment and l.product_id)"/>
        <t t-set="has_price_lines" t-value="bool(visible_price_lines)"/>
        <!-- C2: if no price lines â†’ show columns -->
        <t t-set="show_prices"
           t-value="(not has_price_lines) or bool(visible_price_lines.filtered(lambda l: not l.x_studio_verberg_prijs))"/>

        <tr>
            <th class="text-start">Products</th>
            <th class="text-end">Quantity</th>

            <t t-if="show_prices">
                <th class="text-end d-none d-sm-table-cell">Unit Price</th>
                <th class="text-end d-none d-md-table-cell">Taxes</th>
                <th class="text-end">Amount</th>
            </t>
        </tr>
    </xpath>

    <!-- ==================== BODY LINES ==================== -->
    <xpath expr="//table[@id='sales_order_table']//t[@name='product_line_row']" position="replace">
        <t name="product_line_row" t-if="not line.display_type and line.product_type != 'combo'">

            <!-- 1 Product -->
            <td><span t-field="line.name"/></td>

            <!-- 2 Qty -->
            <td class="text-end">
                <span t-field="line.product_uom_qty"/> <span t-field="line.product_uom"/>
            </td>

            <!-- 3 Unit Price -->
            <t t-if="show_prices">
                <td class="text-end d-none d-sm-table-cell">
                    <t t-if="not line.x_studio_verberg_prijs">
                        <span t-field="line.price_unit"/>
                    </t>
                </td>
            </t>

            <!-- (Discount stays untouched by request: PL1 ) -->

            <!-- 4 Taxes -->
            <t t-if="show_prices">
                <td class="text-end d-none d-md-table-cell">
                    <span t-out="', '.join(x.name for x in line.tax_id)"/>
                </td>
            </t>


            <!-- 5 Amount -->
            <t t-if="show_prices">
                <td class="text-end">
                    <t t-if="not line.x_studio_verberg_prijs">
                        <span t-field="line.price_subtotal"/>
                    </t>
                </td>
            </t>

        </t>
    </xpath>

</template>
</odoo>
